# Bot改修指示書

## 概要

現在のBotに以下の2点の変更を加えてください。

## 1. MAX_POSITION_PERCENTの変更

| 項目 | 値 |
|------|-----|
| 現状 | 0.02（2%） |
| 変更後 | 0.35（35%） |

最小取引量0.001 BTCを確保するために必要な変更です。

## 2. 損切り機能の追加

以下の仕様で損切りロジックを実装してください。

### 環境変数

```
STOP_LOSS_PERCENT=0.10  # デフォルト10%
```

### ロジック

- 買い注文が約定したら、その時点の購入価格を記録する
- 毎回のチェック時に現在価格と購入価格を比較する
- 現在価格が購入価格から `STOP_LOSS_PERCENT` 以上下落していたら、シグナルに関係なく成行売りを実行する
- 損切り売却時はログに「STOP_LOSS」と記録する

### 購入価格の保持方法

| 実行モード | 保持方法 |
|-----------|---------|
| ローカル実行 | メモリ上で保持、または `logs/position.json` などに保存 |
| Vercel Cron | Supabaseに保存するか、環境変数として保持 |

## 3. 変更しない部分

- 移動平均クロスオーバーの戦略はそのまま
- 通貨ペア、時間足などの基本設定はそのまま
- ログ保存の仕組みはそのまま

## 4. 確認事項

実装完了後、以下を確認できるようにしてください。

- 損切り機能の単体テスト（購入価格100万、現在価格89万のとき売却されるか）
- 環境変数の説明を README に追記
